"use strict";(self.webpackChunkcasibase_website=self.webpackChunkcasibase_website||[]).push([[91],{3905:(e,n,r)=>{r.d(n,{Zo:()=>u,kt:()=>f});var t=r(7294);function i(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function s(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,t)}return r}function a(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?s(Object(r),!0).forEach((function(n){i(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function o(e,n){if(null==e)return{};var r,t,i=function(e,n){if(null==e)return{};var r,t,i={},s=Object.keys(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||(i[r]=e[r]);return i}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(t=0;t<s.length;t++)r=s[t],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}var l=t.createContext({}),c=function(e){var n=t.useContext(l),r=n;return e&&(r="function"==typeof e?e(n):a(a({},n),e)),r},u=function(e){var n=c(e.components);return t.createElement(l.Provider,{value:n},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},m=t.forwardRef((function(e,n){var r=e.components,i=e.mdxType,s=e.originalType,l=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),p=c(r),m=i,f=p["".concat(l,".").concat(m)]||p[m]||d[m]||s;return r?t.createElement(f,a(a({ref:n},u),{},{components:r})):t.createElement(f,a({ref:n},u))}));function f(e,n){var r=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var s=r.length,a=new Array(s);a[0]=m;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o[p]="string"==typeof e?e:i,a[1]=o;for(var c=2;c<s;c++)a[c]=r[c];return t.createElement.apply(null,a)}return t.createElement.apply(null,r)}m.displayName="MDXCreateElement"},5762:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>s,metadata:()=>o,toc:()=>c});var t=r(7462),i=(r(7294),r(3905));const s={title:"Backend Permissions",description:"Backend permission utilities in Casibase",keywords:["backend","permissions","Go","access control","authorization"]},a=void 0,o={unversionedId:"permissions/backend-permissions",id:"permissions/backend-permissions",title:"Backend Permissions",description:"Backend permission utilities in Casibase",source:"@site/i18n/fr/docusaurus-plugin-content-docs/current/permissions/backend-permissions.md",sourceDirName:"permissions",slug:"/permissions/backend-permissions",permalink:"/fr/docs/permissions/backend-permissions",draft:!1,editUrl:"https://github.com/casibase/casibase-website/edit/master/docs/permissions/backend-permissions.md",tags:[],version:"current",frontMatter:{title:"Backend Permissions",description:"Backend permission utilities in Casibase",keywords:["backend","permissions","Go","access control","authorization"]},sidebar:"tutorialSidebar",previous:{title:"Frontend Permissions",permalink:"/fr/docs/permissions/frontend-permissions"},next:{title:"Developer Guide",permalink:"/fr/docs/category/developer-guide"}},l={},c=[{value:"Permission Functions",id:"permission-functions",level:2},{value:"<code>IsAdminOrChatAdmin(user)</code>",id:"isadminorchatadminuser",level:3},{value:"<code>IsChatAdmin(user)</code>",id:"ischatadminuser",level:3},{value:"<code>IsVideoNormalUser(user)</code>",id:"isvideonormaluseruser",level:3},{value:"Role Type Constants",id:"role-type-constants",level:2},{value:"Usage in Controllers",id:"usage-in-controllers",level:2},{value:"Authorization Filter",id:"authorization-filter",level:3},{value:"API Controllers",id:"api-controllers",level:3},{value:"Service Layer",id:"service-layer",level:3},{value:"Migration Impact",id:"migration-impact",level:2},{value:"Safety Features",id:"safety-features",level:2}],u={toc:c},p="wrapper";function d(e){let{components:n,...r}=e;return(0,i.kt)(p,(0,t.Z)({},u,r,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Casibase's Go backend centralizes permission checking through utility functions in ",(0,i.kt)("inlineCode",{parentName:"p"},"util/permission.go"),". These functions provide consistent role validation across controllers, routers, and service layers."),(0,i.kt)("h2",{id:"permission-functions"},"Permission Functions"),(0,i.kt)("h3",{id:"isadminorchatadminuser"},(0,i.kt)("inlineCode",{parentName:"h3"},"IsAdminOrChatAdmin(user)")),(0,i.kt)("p",null,"Checks if a user is either a system admin or a chat admin."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'if !util.IsAdminOrChatAdmin(user) {\n    c.ResponseError("this operation requires admin privilege")\n    return\n}\n')),(0,i.kt)("p",null,"Returns ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," for:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Users with ",(0,i.kt)("inlineCode",{parentName:"li"},"IsAdmin")," flag set"),(0,i.kt)("li",{parentName:"ul"},"Users with ",(0,i.kt)("inlineCode",{parentName:"li"},'Type == "chat-admin"'))),(0,i.kt)("p",null,"This is the most commonly used permission check for operations that require elevated privileges."),(0,i.kt)("h3",{id:"ischatadminuser"},(0,i.kt)("inlineCode",{parentName:"h3"},"IsChatAdmin(user)")),(0,i.kt)("p",null,"Checks specifically for chat admin role."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"if util.IsChatAdmin(user) {\n    // Grant chat-admin specific permissions\n}\n")),(0,i.kt)("p",null,"Returns ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," only for users with ",(0,i.kt)("inlineCode",{parentName:"p"},'Type == "chat-admin"'),"."),(0,i.kt)("h3",{id:"isvideonormaluseruser"},(0,i.kt)("inlineCode",{parentName:"h3"},"IsVideoNormalUser(user)")),(0,i.kt)("p",null,"Checks if a user has the video-normal-user role, which has restricted video editing permissions."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'if util.IsVideoNormalUser(user) {\n    if len(video.Remarks) > 0 || video.State != "Draft" {\n        c.ResponseError("video can only be updated in Draft state")\n        return\n    }\n}\n')),(0,i.kt)("p",null,"Returns ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," for users with ",(0,i.kt)("inlineCode",{parentName:"p"},'Type == "video-normal-user"'),"."),(0,i.kt)("h2",{id:"role-type-constants"},"Role Type Constants"),(0,i.kt)("p",null,"The package defines constants for role types to eliminate hardcoded strings:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'const (\n    UserTypeChatAdmin       = "chat-admin"\n    UserTypeVideoNormalUser = "video-normal-user"\n)\n')),(0,i.kt)("p",null,"These constants ensure type safety and prevent typos when checking user roles."),(0,i.kt)("h2",{id:"usage-in-controllers"},"Usage in Controllers"),(0,i.kt)("h3",{id:"authorization-filter"},"Authorization Filter"),(0,i.kt)("p",null,"The router middleware uses permission checks to protect admin endpoints:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'// routers/authz_filter.go\nfunc permissionFilter(ctx *context.Context) {\n    user := GetSessionUser(ctx)\n    \n    if !util.IsAdminOrChatAdmin(user) {\n        responseError(ctx, "this operation requires admin privilege")\n        return\n    }\n}\n')),(0,i.kt)("h3",{id:"api-controllers"},"API Controllers"),(0,i.kt)("p",null,"Controllers use these functions to enforce business logic permissions:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'// controllers/account.go - User type assignment\nif strings.Count(claims.Type, "-") <= 1 {\n    if !util.IsAdminOrChatAdmin(&claims.User) {\n        claims.Type = "chat-user"\n    }\n}\n\n// controllers/video.go - Video update restrictions\nif util.IsVideoNormalUser(user) {\n    if len(video.Remarks) > 0 || video.State != "Draft" {\n        c.ResponseError("video can only be updated when state is Draft")\n        return\n    }\n}\n')),(0,i.kt)("h3",{id:"service-layer"},"Service Layer"),(0,i.kt)("p",null,"Object and service layers also benefit from centralized checks:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"// object/util.go\nfunc isAdmin(user *casdoorsdk.User) bool {\n    return util.IsAdminOrChatAdmin(user)\n}\n")),(0,i.kt)("h2",{id:"migration-impact"},"Migration Impact"),(0,i.kt)("p",null,"Before centralization, permission checks were duplicated across the codebase:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'// Before: inline, repeated logic\nisAdmin := user != nil && (user.IsAdmin || user.Type == "chat-admin")\nif !isAdmin {\n    return error\n}\n\n// After: single, reusable function\nif !util.IsAdminOrChatAdmin(user) {\n    return error\n}\n')),(0,i.kt)("p",null,"The migration improved:"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Maintainability"),": Permission logic changes happen in one place\n",(0,i.kt)("strong",{parentName:"p"},"Consistency"),": All parts of the system use identical checks\n",(0,i.kt)("strong",{parentName:"p"},"Security"),": Reduced risk of permission check errors"),(0,i.kt)("h2",{id:"safety-features"},"Safety Features"),(0,i.kt)("p",null,"All permission functions include null safety checks:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"func IsAdminOrChatAdmin(user *casdoorsdk.User) bool {\n    if user == nil {\n        return false\n    }\n    return user.IsAdmin || user.Type == UserTypeChatAdmin\n}\n")),(0,i.kt)("p",null,"This prevents nil pointer dereferences and ensures permission checks fail safely when user data is unavailable."))}d.isMDXComponent=!0}}]);